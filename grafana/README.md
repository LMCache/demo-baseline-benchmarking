# Lab sever monitoring script

## Deployment

**Prerequisite**: docker

```bash
pip install -r requirement.txt
bash start.sh
```

The Grafana website will be opened on port 3000.

## Dashboard configuration

Use `grafana-dashboard/model.json` on the Grafana website to deploy the dashboard.


## Migration guide (generated by GPT)

Migrating Prometheus and Grafana running inside Docker containers to a new host server while retaining configurations, dashboards, and databases involves several steps. The process ensures that your monitoring setup continues to work seamlessly after the migration. Here's a step-by-step guide to accomplish this:

### 1. Backup Current Data
First, you need to backup the data for both Prometheus and Grafana. This includes configuration files, data stores, and any custom settings.

- Prometheus: Backup the Prometheus data directory. This directory includes the time series database and the prometheus.yml configuration file if you've mounted it as a volume.
- Grafana: Backup the Grafana data directory. This includes Grafana's database (where dashboards and configurations are stored), plugins, and configuration file (grafana.ini or custom.ini).

If you're using Docker volumes to store data (which is recommended for persisting data), you can locate your volumes using:

```bash
docker volume ls
```

And then back them up using the docker cp command or by directly copying the volume data from the Docker volumes directory (usually `/var/lib/docker/volumes/` on the host).

### 2. Prepare the New Host
- Ensure Docker is installed on the new host.
- Prepare the environment on the new host similar to the old one, considering network settings, Docker versions, and any other dependencies.

### 3. Transfer Backups to the New Host
Securely transfer the backup data to the new host. You can use scp, rsync, or any other secure method to transfer the data.

### 4. Restore Data on the New Host
- **Prometheus**:
  - Create a new Docker volume or prepare a directory on the new host for Prometheus data.
  - Restore the Prometheus data to this volume or directory.
- **Grafana**:
  - Similarly, create a new Docker volume or prepare a directory for Grafana.
  - Restore the Grafana data to this volume or directory.
 
### 5. Run Prometheus and Grafana on the New Host
Use the Docker run command or Docker Compose, depending on your setup, to start Prometheus and Grafana on the new host. Ensure you mount the restored volumes or directories to the correct path inside the containers.

For example, when using Docker run:

```bash
docker run -d --name prometheus -p 9090:9090 -v /path/to/prometheus/data:/prometheus prom/prometheus
docker run -d --name grafana -p 3000:3000 -v /path/to/grafana/data:/var/lib/grafana grafana/grafana
```
Adjust the volume paths (`/path/to/prometheus/data` and `/path/to/grafana/data`) to where you've restored your data.

### 6. Verify the Migration
After starting the services, verify that Prometheus and Grafana are running correctly on the new host. Check the Prometheus targets and Grafana dashboards to ensure everything is working as expected.

**Tips**

Consider using Docker Compose to manage your containers, as it can simplify the process of configuring and starting multiple containers with their respective volumes and environment settings.
Ensure your new host has adequate resources (CPU, memory, disk space) to support your Prometheus and Grafana instances.
Check for any version compatibility issues, especially if there's a significant version difference between the Docker images used in the old and new hosts.
By following these steps, you can successfully migrate your Prometheus and Grafana instances to a new host without losing any data or configurations.
